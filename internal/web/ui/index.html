<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TradeBot ¬∑ Web App</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
<style>
  :root{
    --bg:#0b0f17; --panel:#111826; --line:#1f2837; --text:#e6edf3; --muted:#9aa4af;
    --brand:#ff79c6; --brand2:#a78bfa; --ok:#8bff9b; --err:#ff7a7a;
  }
  *{box-sizing:border-box} html,body{margin:0;height:100%;font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--text)}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:14px;margin-bottom:12px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .space{flex:1}
  .chip{padding:6px 10px;border:1px solid var(--line);border-radius:999px;cursor:pointer}
  .chip.active{background:linear-gradient(90deg,var(--brand),var(--brand2));color:#0b0f17;border:0}
  /* Buttons: base = neutral; active/primary = gradient */
  .btn{
    background:transparent;
    border:1px solid var(--line);
    color:var(--text);
    border-radius:10px;
    padding:10px 12px;
    cursor:pointer;
    font-weight:600;
    transition:.15s ease-in-out;
  }
  .btn:hover{ border-color:#2a3550 }
  /* primary actions keep gradient explicitly */
  .btn-primary{
    background:linear-gradient(90deg,var(--brand),var(--brand2));
    color:#0b0f17;
    border:0;
  }
  /* toggled state (e.g., active feed) */
  .btn.active{
    background:linear-gradient(90deg,var(--brand),var(--brand2));
    color:#0b0f17;
    border:0;
  }
  .btn:disabled{ opacity:.6; cursor:not-allowed }
  /* legacy alias; safe no-op override */
  .btn.ghost{ /* same as .btn (neutral) */ }
  select,input{background:var(--bg);color:var(--text);border:1px solid var(--line);border-radius:10px;padding:8px}
  #chart{height:380px}
  .bubble{position:fixed;right:16px;bottom:16px;display:flex;gap:10px;align-items:center;background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:10px 12px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
  .bubble img{width:48px;height:48px;border-radius:50%;border:1px solid var(--line)}
  .muted{color:var(--muted)}
  pre{white-space:pre-wrap}
</style>
</head>
<body>
<div class="wrap">
  <!-- Topbar -->
  <div class="card">
    <div class="row">
      <div style="font-weight:700;font-size:18px">üå∏ TradeBot</div>
      <div class="chip" data-tf="1m">1m</div>
      <div class="chip" data-tf="5m">5m</div>
      <div class="chip" data-tf="15m">15m</div>
      <div class="chip" data-tf="1h">1h</div>
      <div class="space"></div>
      <select id="symbol"><option>BTCUSDT</option><option>ETHUSDT</option></select>
      <button id="open-terminal" class="btn ghost">Open in Chat</button>
    </div>
  </div>

  <!-- Chart -->
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div style="font-weight:600">Chart</div>
      <div class="row">
        <button class="btn ghost" id="load">Load history</button>
        <button class="btn ghost" id="ping">Ping</button>
      </div>
    </div>
    <div id="chart"></div>
  </div>

  <!-- Backtest -->
  <div class="card">
    <div style="font-weight:600;margin-bottom:8px">Backtest</div>
    <div class="row" style="gap:12px; align-items:flex-end; flex-wrap:wrap">
      <div>
        <div class="muted" style="font-size:12px">From</div>
        <input id="bt-from" type="datetime-local">
      </div>
      <div>
        <div class="muted" style="font-size:12px">To</div>
        <input id="bt-to" type="datetime-local">
      </div>
      <div>
        <div class="muted" style="font-size:12px">Equity</div>
        <input id="bt-eq" type="number" value="10000" step="100">
      </div>
      <div>
        <div class="muted" style="font-size:12px">Lev</div>
        <input id="bt-lev" type="number" value="1" step="1">
      </div>
      <div>
        <div class="muted" style="font-size:12px">Strategy</div>
        <select id="bt-strat">
          <option value="ema_atr">EMA+ATR</option>
          <option value="rsi">RSI</option>
        </select>
      </div>
      <div style="min-width:280px">
        <div class="muted" style="font-size:12px">Args (JSON)</div>
        <input id="bt-args" value='{"fast":9,"slow":21,"atr":14,"R":1.5}'>
      </div>
      <div style="min-width:220px">
        <div class="muted" style="font-size:12px">Fees (bps)</div>
        <input id="bt-fees" value='{"makerBps":2,"takerBps":5}'>
      </div>
      <button class="btn btn-primary" id="bt-run">Run backtest</button>
      <a id="bt-zip" class="btn ghost" style="display:none" href="#" download>Download ZIP</a>
      <div class="space"></div>
      <div id="bt-summary" class="muted" style="font-family:ui-monospace,monospace"></div>
    </div>
  </div>

  <!-- Controls -->
  <div class="card">
    <div style="font-weight:600;margin-bottom:6px">Controls</div>
    <div class="row">
      <!-- feed-toggles are neutral by default; only .active is highlighted -->
      <button class="btn" id="feed-random">üì° Feed: Random</button>
      <button class="btn" id="feed-rest">üì° Feed: Rest</button>
      <button class="btn ghost" id="save-state">üíæ Save</button>
      <button class="btn ghost" id="load-state">üìÇ Load</button>
      <button class="btn ghost" id="reset-state">üßπ Reset</button>
      <div class="space"></div>
      <div id="status" class="muted"></div>
    </div>
  </div>

  <!-- Live stream -->
  <div class="card">
    <div style="font-weight:600;margin-bottom:6px">Live stream</div>
    <pre id="stream" class="muted"></pre>
  </div>
</div>

<!-- Mascot bubble -->
<div class="bubble">
  <img id="aria-img" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'%3E%3Cdefs%3E%3CradialGradient id='g' cx='50%25' cy='45%25' r='55%25'%3E%3Cstop offset='0%25' stop-color='%23ffe4f4'/%3E%3Cstop offset='100%25' stop-color='%23ff8ccf'/%3E%3C/radialGradient%3E%3ClinearGradient id='h' x1='0%25' x2='0%25' y1='0%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23ffffff' stop-opacity='.85'/%3E%3Cstop offset='100%25' stop-color='%23ffe4f4' stop-opacity='.1'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='48' cy='48' r='46' fill='%23ff9ad8' stroke='%23d35aa5' stroke-width='4'/%3E%3Ccircle cx='48' cy='46' r='40' fill='url(%23g)'/%3E%3Cellipse cx='34' cy='44' rx='7' ry='9' fill='%23fff'/%3E%3Cellipse cx='62' cy='44' rx='7' ry='9' fill='%23fff'/%3E%3Ccircle cx='34' cy='44' r='3.4' fill='%235b2a62'/%3E%3Ccircle cx='62' cy='44' r='3.4' fill='%235b2a62'/%3E%3Cpath d='M28 60q10 12 20 12t20-12' fill='none' stroke='%235b2a62' stroke-width='4' stroke-linecap='round'/%3E%3Cpath d='M32 28c6-6 26-6 32 0' fill='none' stroke='url(%23h)' stroke-width='6' stroke-linecap='round'/%3E%3C/svg%3E" alt="aria">
  <div>
    <div style="font-weight:600">–ê—Ä–∏—è</div>
    <div class="muted" id="aria-msg">–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É üå∏</div>
  </div>
</div>

<script src="/ui/app.js"></script>
</body>
</html>
